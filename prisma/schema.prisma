generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(cuid())
  name       String
  email      String     @unique
  password   String
  role       UserRole   @default(WAITER)
  phone      String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  auditLogs  AuditLog[]
  deliveries Delivery[]
  orders     Order[]    @relation("OrderWaiter")
  collectedBills Bill[] @relation("BillCollector")
}

model RawMaterial {
  id            String                 @id @default(cuid())
  name          String
  unit          String
  currentStock  Float                  @default(0)
  minStockLevel Float                  @default(5)
  costPerUnit   Float                  @default(0)
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  transactions  InventoryTransaction[]
  recipeItems   RecipeItem[]
}

model Supplier {
  id        String                 @id @default(cuid())
  name      String
  contact   String?
  phone     String?
  email     String?
  createdAt DateTime               @default(now())
  purchases InventoryTransaction[]
}

model InventoryTransaction {
  id              String          @id @default(cuid())
  type            TransactionType
  quantity        Float
  cost            Float?
  notes           String?
  transactionDate DateTime        @default(now())
  materialId      String
  supplierId      String?
  material        RawMaterial     @relation(fields: [materialId], references: [id])
  supplier        Supplier?       @relation(fields: [supplierId], references: [id])
}

model Category {
  id    String     @id @default(cuid())
  name  String
  image String?
  type  MenuType   @default(EASTERN)
  items MenuItem[]
}

model MenuItem {
  id          String       @id @default(cuid())
  name        String
  description String?
  price       Float
  image       String?
  isAvailable Boolean      @default(true)
  categoryId  String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  category    Category     @relation(fields: [categoryId], references: [id])
  orderItems  OrderItem[]
  recipe      RecipeItem[]
  offers      Offer[]      @relation("MenuItemOffers")
}

model RecipeItem {
  id         String      @id @default(cuid())
  quantity   Float
  menuItemId String
  materialId String
  material   RawMaterial @relation(fields: [materialId], references: [id])
  menuItem   MenuItem    @relation(fields: [menuItemId], references: [id], onDelete: Cascade)
}

model Offer {
  id          String     @id @default(cuid())
  name        String
  description String?
  discountPct Float
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean    @default(true)
  menuItems   MenuItem[] @relation("MenuItemOffers")
}

model Table {
  id           String        @id @default(cuid())
  number       String        @unique
  capacity     Int
  status       TableStatus   @default(AVAILABLE)
  x            Int           @default(0)
  y            Int           @default(0)
  reservations Reservation[]
  orders       Order[]
}

model Reservation {
  id              String   @id @default(cuid())
  customerName    String
  customerPhone   String
  guests          Int
  reservationTime DateTime
  notes           String?
  status          String   @default("CONFIRMED")
  tableId         String?
  table           Table?   @relation(fields: [tableId], references: [id])
}

model Order {
  id          String      @id @default(cuid())
  orderNumber Int         @unique @default(autoincrement())
  status      OrderStatus @default(PENDING)
  totalAmount Float       @default(0)
  tax         Float       @default(0)
  serviceFee  Float       @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  note        String?
  tableId     String?
  waiterId    String?
  bills       Bill[]
  delivery    Delivery?
  items       OrderItem[]
  table       Table?      @relation(fields: [tableId], references: [id])
  waiter      User?       @relation("OrderWaiter", fields: [waiterId], references: [id])

  @@map("orders")
}

model OrderItem {
  id         String      @id @default(cuid())
  quantity   Int
  unitPrice  Float
  totalPrice Float
  notes      String?
  orderId    String
  menuItemId String
  cost       Float       @default(0)
  status     OrderStatus @default(PENDING)
  menuItem   MenuItem    @relation(fields: [menuItemId], references: [id])
  order      Order       @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Bill {
  id            String        @id @default(cuid())
  amount        Float
  paymentMethod PaymentMethod @default(CASH)
  paidAt        DateTime      @default(now())
  orderId       String
  order         Order         @relation(fields: [orderId], references: [id])
  isSettled     Boolean       @default(false)
  settledAt     DateTime?
  collectedById String?
  collectedBy   User?         @relation("BillCollector", fields: [collectedById], references: [id])
}

model Delivery {
  id               String    @id @default(cuid())
  customerName     String
  customerPhone    String
  address          String
  deliveryFee      Float
  estimatedTime    Int?
  status           String    @default("PENDING")
  orderId          String    @unique
  driverId         String?
  handedOverAt     DateTime?
  isCashHandedOver Boolean   @default(false)
  driver           User?     @relation(fields: [driverId], references: [id])
  order            Order     @relation(fields: [orderId], references: [id])
}

model Expense {
  id          String   @id @default(cuid())
  description String
  amount      Float
  category    String
  date        DateTime @default(now())
  recordedBy  String
}

model DailyClose {
  id            String   @id @default(cuid())
  date          DateTime @unique @default(now())
  totalSales    Float
  totalCash     Float
  totalCard     Float
  totalExpenses Float
  netProfit     Float
  closedBy      String
  notes         String?
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  details   String?
  createdAt DateTime @default(now())
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])
}

model SystemSetting {
  id             String   @id @default(cuid())
  restaurantName String   @default("My Restaurant")
  currency       String   @default("USD")
  taxRate        Float    @default(0)
  serviceFee     Float    @default(0)
  updatedAt      DateTime @updatedAt
}

enum UserRole {
  ADMIN
  MANAGER
  WAITER
  CHEF
  ACCOUNTANT
  DRIVER
  CAPTAIN
  DELIVERY_MANAGER
  CASHIER
  STORE_MANAGER
}

enum OrderStatus {
  PENDING
  PREPARING
  READY
  SERVED
  COMPLETED
  CANCELLED
}

enum TableStatus {
  AVAILABLE
  OCCUPIED
  RESERVED
  DIRTY
}

enum PaymentMethod {
  CASH
  CARD
  ONLINE
}

enum MenuType {
  EASTERN
  WESTERN
  BEVERAGE
  DESSERT
}

enum TransactionType {
  PURCHASE
  USAGE
  WASTE
  ADJUSTMENT
}
